<div class="mission-container">

  <div class="mission-header-card">
    <div class="header-left">
      <h1>My Missions</h1>
      <p>Manage your active missions and track progress.</p>
    </div>

    <button (click)="openDialog()" class="new-mission-btn">
      <span class="material-icons">add</span>
      New Mission
    </button>
  </div>

  <!-- Stats Grid -->
  <div class="stats-overview">
    <div class="stat-box">
      <span class="stat-label">Total Active</span>
      <span class="stat-number">{{ stats.total }}</span>
    </div>
    <div class="stat-box">
      <span class="stat-label">Leading</span>
      <span class="stat-number text-primary">{{ stats.leading }}</span>
    </div>
    <div class="stat-box">
      <span class="stat-label">Joined</span>
      <span class="stat-number text-secondary">{{ stats.joined }}</span>
    </div>
    <div class="stat-box points-box">
      <span class="stat-label">My Points</span>
      <span class="stat-number text-gold">{{ stats.points | number }}</span>
    </div>
  </div>

  <!-- Leading Missions Section -->
  <div class="section-divider">
    <h2><span class="material-icons">star</span> Leading Missions</h2>
  </div>

  <div class="mission-grid">
    @for (mission of leadingMissions; track mission.id) {
    <div class="mission-card" [ngClass]="getDifficultyClass(mission.difficulty)">

      <div class="card-header">
        <div class="mission-badges">
          <span class="id-badge">#{{ mission.id }}</span>
          <span class="difficulty-badge" [ngClass]="getDifficultyClass(mission.difficulty)">
            {{ mission.difficulty || 'NORMAL' }}
          </span>
        </div>
        <div class="card-actions">
          <button class="icon-btn edit" (click)="onEdit(mission)" title="Edit">
            <span class="material-icons">edit</span>
          </button>
          <button class="icon-btn delete" (click)="onDelete(mission)" title="Delete">
            <span class="material-icons">delete</span>
          </button>
          <button class="icon-btn chat" (click)="onChat(mission)" title="Voice Team">
            <span class="material-icons">headset_mic</span>
          </button>
        </div>
      </div>

      <h3 class="mission-title">{{ mission.name }}</h3>
      <p class="mission-desc">{{ mission.description || 'No description provided.' }}</p>

      <div class="mission-meta">
        <div class="meta-item points">
          <span class="material-icons">emoji_events</span>
          <span>{{ mission.base_points || 0 }} pts</span>
        </div>
        <div class="meta-item status">
          <span class="status-dot" [ngClass]="mission.status.toLowerCase()"></span>
          <span>{{ mission.status }}</span>
        </div>
      </div>

      <div class="crew-progress">
        <div class="progress-label">
          <span>Crew</span>
          <span>{{ mission.crew_count }} / {{ mission.max_crew || 3 }}</span>
        </div>
        <div class="progress-bar-bg">
          <div class="progress-bar-fill" [style.width.%]="((mission.crew_count || 0) / (mission.max_crew || 3)) * 100">
          </div>
        </div>
      </div>

      <div class="mission-actions-bar">
        @if (mission.status === 'Open') {
        <button class="action-btn start-btn" (click)="onStart(mission)">
          <span class="material-icons">play_arrow</span> Start
        </button>
        }
        @if (mission.status === 'InProgress') {
        <button class="action-btn complete-btn" (click)="onComplete(mission)">
          <span class="material-icons">check_circle</span> Finish
        </button>
        <button class="action-btn fail-btn" (click)="onFail(mission)">
          <span class="material-icons">cancel</span> Fail
        </button>
        }
      </div>

    </div>
    } @empty {
    <div class="no-data-state">
      <p>You haven't created any missions yet.</p>
      <button (click)="openDialog()" class="text-btn">Create one now</button>
    </div>
    }
  </div>

  <!-- Joined Missions Section -->
  <div class="section-divider mt-5">
    <h2><span class="material-icons">handshake</span> Joined Missions</h2>
  </div>

  <div class="mission-grid">
    @for (mission of joinedMissions; track mission.id) {
    <div class="mission-card joined-card">

      <div class="card-header">
        <div class="mission-badges">
          <span class="id-badge">#{{ mission.id }}</span>
          <span class="difficulty-badge" [ngClass]="getDifficultyClass(mission.difficulty)">
            {{ mission.difficulty || 'NORMAL' }}
          </span>
        </div>
        <span class="status-dot" [ngClass]="mission.status.toLowerCase()"></span>
      </div>

      <h3 class="mission-title">{{ mission.name }}</h3>

      <div class="mission-meta">
        <div class="meta-item chief">
          <span class="material-icons">person</span>
          <span>Chief {{ mission.chief_id }}</span>
        </div>
        <div class="meta-item points">
          <span class="material-icons">emoji_events</span>
          <span>{{ mission.base_points || 0 }} pts</span>
        </div>
      </div>

      <div class="card-footer">
        <span class="created-date">Joined: {{ mission.created_at | date:'MMM d' }}</span>
        <div class="action-row">
          <button class="chat-btn" (click)="onChat(mission)">
            <span class="material-icons">headset_mic</span> Voice Team
          </button>
          <button class="leave-btn" (click)="onLeave(mission)">
            Leave Mission
          </button>
        </div>
      </div>

    </div>
    } @empty {
    <div class="no-data-state">
      <p>You haven't joined any missions.</p>
    </div>
    }
  </div>

</div>